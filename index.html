<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Plan de estudios ‚ãÜ‚≠íÀö ìçùÔΩ°‚ãÜ (2016)</title>

<!-- Font (si hay conexi√≥n cargar√° Poppins; si no, usar√°n fuentes del sistema) -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<style>
/* ==========================
   PASTEL ROSA + CONEJITOS (SVG pattern)
   ========================== */

/* Cute rabbit SVG encoded as data URI for background pattern */
:root{
  --bg-1: #fff5f8;
  --bg-2: #ffeef4;
  --panel: #ffffff;
  --rose-100: #ffe7ef;
  --rose-200: #ffd1e0;
  --rose-300: #ffb9d0;
  --accent: #f6a6c3;
  --primary: #d87fb0;
  --ok: #82cfa3;
  --danger: #f08fa0;
  --shadow: 0 8px 24px rgba(180,100,140,0.12);
  --radius: 16px;
  font-family: "Poppins", "Segoe UI", Roboto, Arial, sans-serif;
}

/* data URI for small rabbit icon SVG (white rabbit with pink ears) */
body{
  margin:0;
  padding:28px;
  background: linear-gradient(180deg,var(--bg-1),var(--bg-2));
  color:#3b2b3b;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  background-image:
    radial-gradient(rgba(255,255,255,0.5) 1px, transparent 1px),
    url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='64' height='64' viewBox='0 0 64 64'><g fill='none' fill-rule='evenodd'><rect width='64' height='64' rx='12' fill='%23ffd9ea'/><g transform='translate(6 6)'><ellipse cx='26' cy='30' rx='20' ry='14' fill='%23fff1f6'/><path d='M18 8c-3-6 6-10 10-6 4 4 1 9-3 11-3 2-11 2-13-5z' fill='%23fff'/><path d='M36 6c4-5 11-4 12 0 1 4-5 7-8 7-2 0-6-1-4-7z' fill='%23ffd9ea'/><path d='M20 32c0-2 3-2 6-2s6 1 6 2c0 1-3 2-6 2s-6-1-6-2z' fill='%23ffd9ea' opacity='0.9'/><circle cx='22' cy='28' r='1.6' fill='%23f08fa0'/><circle cx='30' cy='28' r='1.6' fill='%23f08fa0'/></g></g></svg>");
  background-size: 220px 220px, auto;
  background-repeat: repeat;
  background-position: 0 0;
}

/* Page layout */
.container {
  max-width:1200px;
  margin:0 auto;
}

/* Header */
header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:16px;
  margin-bottom:22px;
  flex-wrap:wrap;
}
h1{
  margin:0;
  font-size:24px;
  line-height:1.05;
  color:var(--primary);
  letter-spacing:0.6px;
}
.subtitle{
  margin:4px 0 0 0;
  font-size:13px;
  color:#6f4a61;
}

/* Controls */
.controls{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
button{
  border:0;
  border-radius:12px;
  padding:9px 14px;
  cursor:pointer;
  font-size:13px;
  box-shadow:var(--shadow);
  transition:transform .12s ease, opacity .12s ease;
}
button:hover{transform:translateY(-3px);opacity:0.95}
#export{background:linear-gradient(180deg,var(--rose-200),var(--rose-300)); color:#521e3a}
#import{background:linear-gradient(180deg,#ffe1ef,#ffd1e6); color:#5b2a43}
#reset{background:linear-gradient(180deg,#fff1f5,#ffdbe7); color:#8b2b45}

/* Grid of semesters */
.grid{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:16px;
}
@media(max-width:1100px){.grid{grid-template-columns:repeat(3,1fr)}}
@media(max-width:800px){.grid{grid-template-columns:repeat(2,1fr)}}
@media(max-width:560px){.grid{grid-template-columns:1fr}}

/* Semester card */
.semester{
  background:linear-gradient(180deg,#fff,#fff4fb);
  border-radius:var(--radius);
  padding:14px;
  box-shadow:var(--shadow);
  border:1px solid rgba(212,160,190,0.12);
  min-height:140px;
}
.semester h3{
  margin:0 0 10px 0;
  font-size:16px;
  color:#7b3a5a;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.semester h3 span{font-size:13px;color:#8e657f}

/* Course list and item */
.course-list{display:flex;flex-direction:column;gap:10px}
.course{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:8px;
  padding:10px;
  border-radius:12px;
  background:linear-gradient(180deg,#ffffff,#fff7fb);
  border:1px solid rgba(230,200,220,0.7);
  box-shadow:0 6px 14px rgba(160,90,130,0.06);
  cursor:pointer;
  position:relative;
  transition:transform .12s ease, box-shadow .12s ease, opacity .12s ease;
}
.course:hover{transform:translateY(-4px);box-shadow:0 12px 30px rgba(150,80,120,0.12)}
.course.locked{opacity:0.62;cursor:default;transform:none;box-shadow:none}

/* left area */
.left{display:flex;align-items:center;gap:10px}
.code{
  min-width:68px;
  text-align:center;
  font-weight:700;
  padding:8px;
  border-radius:10px;
  background:linear-gradient(180deg,#fff5f7,#ffe7ef);
  color:#6b2a44;
  font-size:12px;
}
.meta .title{font-weight:600;color:#4c2440}
.meta .sub{font-size:12px;color:#8b667b;margin-top:2px}

/* status area */
.status .badge{
  padding:8px 10px;border-radius:10px;font-weight:700;font-size:12px;text-align:center;
}
.badge.approved{background:linear-gradient(180deg,#dff8ea,#c8f0dc);color:#12593b}
.badge.locked{background:linear-gradient(180deg,#ffdce6,#ffc6da);color:#641f36}
.badge.available{background:linear-gradient(180deg,#fff3f6,#ffe6ef);color:#6b2a44}

/* tooltip for locked items */
.tooltip{
  display:none;
  position:absolute;
  top:calc(100% + 8px);
  left:12px;
  background:#6a3752;
  color:#fff;
  padding:8px 10px;
  border-radius:10px;
  font-size:12px;
  white-space:nowrap;
  box-shadow:0 10px 30px rgba(60,30,80,0.25);
  z-index:40;
}
.course.locked:hover .tooltip{display:block}

/* footer legend */
footer{
  margin-top:20px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  flex-wrap:wrap;
  gap:8px;
  color:#6f4a61;
  font-size:13px;
}
.legend{display:flex;gap:8px;align-items:center}
.legend .item{background:#fff;border-radius:10px;padding:6px 8px;border:1px solid rgba(230,200,220,0.6);display:flex;gap:8px;align-items:center}

/* small-screen header */
@media(max-width:720px){header{flex-direction:column;align-items:flex-start}}
</style>
</head>
<body>
<div class="container">
  <header>
    <div>
      <h1>Plan de estudios ‚ãÜ‚≠íÀö ìçùÔΩ°‚ãÜ (2016)</h1>
      <div class="subtitle">Malla curricular interactiva ‚Äî Derecho. Marca materias como aprobadas; las que dependan de otras quedar√°n bloqueadas hasta cumplir prerrequisitos.</div>
    </div>
    <div class="controls" role="region" aria-label="Controles de la malla">
      <button id="export" title="Exportar progreso en JSON">Exportar progreso</button>
      <button id="import" title="Importar progreso desde JSON" id="import">Importar progreso</button>
      <button id="reset" title="Borrar todo el progreso">Borrar progreso</button>
    </div>
  </header>

  <main>
    <div id="malla" class="grid" aria-live="polite"></div>
  </main>

  <footer>
    <div class="legend" aria-hidden="true">
      <div class="item"><div style="width:12px;height:12px;background:linear-gradient(180deg,#dff8ea,#c8f0dc);border-radius:4px"></div>Aprobada</div>
      <div class="item"><div style="width:12px;height:12px;background:linear-gradient(180deg,#ffdce6,#ffc6da);border-radius:4px"></div>Bloqueada</div>
      <div class="item"><div style="width:12px;height:12px;background:linear-gradient(180deg,#fff3f6,#ffe6ef);border-radius:4px"></div>Disponible</div>
    </div>
    <div>Fuente: Plan de estudios Derecho 2016 (revisi√≥n 2019)</div>
  </footer>
</div>

<script>
/* ==========================
   MALLA COMPLETA (12 semestres)
   Igual a la estructura original solicitada por el usuario.
   Tokens especiales (ej. __128_CREDITS__) se tratan como requisitos no verificados autom√°ticamente.
   ========================== */

const MALLA = [
  {sem:"I", courses:[
    {code:"DE16-0101", name:"Comunicaci√≥n I", prereq:[]},
    {code:"DE16-0102", name:"Introducci√≥n a la Filosof√≠a", prereq:[]},
    {code:"DE16-0103", name:"Introducci√≥n a la Vida Universitaria", prereq:[]},
    {code:"DE16-0104", name:"Introducci√≥n al Estudio del Derecho", prereq:[]},
    {code:"DE16-0105", name:"Metodolog√≠a del Estudio", prereq:[]},
    {code:"DE16-0106", name:"Taller de Liderazgo", prereq:[]},
    {code:"DE16-0107", name:"Teatro", prereq:[]}
  ]},
  {sem:"II", courses:[
    {code:"DE16-0208", name:"Antropolog√≠a Filos√≥fica y Teol√≥gica", prereq:["DE16-0102"]},
    {code:"DE16-0209", name:"Comunicaci√≥n II", prereq:["DE16-0101"]},
    {code:"DE16-0210", name:"Historia de la Cultura Occidental I", prereq:["DE16-0102"]},
    {code:"DE16-0211", name:"Historia General del Derecho", prereq:["DE16-0105","DE16-0104"]},
    {code:"DE16-0212", name:"Ret√≥rica y Dial√©ctica", prereq:["DE16-0104","DE16-0107","DE16-0101"]},
    {code:"DE16-0213", name:"Teor√≠a del Derecho", prereq:["DE16-0105","DE16-0106","DE16-0104"]},
    {code:"DE16-0214", name:"Apreciaci√≥n Art√≠stica (EH)", prereq:[]},
    {code:"DE16-0215", name:"Apreciaci√≥n Literaria (EH)", prereq:[]}
  ]},
  {sem:"III", courses:[
    {code:"DE16-0316", name:"Bases Romanistas del Derecho Contempor√°neo", prereq:["DE16-0211"]},
    {code:"DE16-0317", name:"Ciencia Pol√≠tica", prereq:["DE16-0102","DE16-0213"]},
    {code:"DE16-0318", name:"Derecho Natural", prereq:["DE16-0208","DE16-0209","DE16-0213","DE16-0212"]},
    {code:"DE16-0319", name:"Historia de la Cultura Occidental II", prereq:["DE16-0210"]},
    {code:"DE16-0320", name:"L√≥gica y Gnoseolog√≠a", prereq:["DE16-0208"]},
    {code:"DE16-0321", name:"Matem√°tica para abogados", prereq:["DE16-0213"]},
    {code:"DE16-0322", name:"Apreciaci√≥n Musical (EH)", prereq:[]},
    {code:"DE16-0323", name:"Sociolog√≠a y Derecho (EH)", prereq:["DE16-0213"]}
  ]},
  {sem:"IV", courses:[
    {code:"DE16-0424", name:"Derecho Constitucional I", prereq:["DE16-0318","DE16-0317"]},
    {code:"DE16-0425", name:"Derecho de Personas", prereq:["DE16-0318","DE16-0316"]},
    {code:"DE16-0426", name:"Derecho Penal General", prereq:["DE16-0318"]},
    {code:"DE16-0427", name:"Derecho y Econom√≠a", prereq:["DE16-0321"]},
    {code:"DE16-0428", name:"Psicolog√≠a", prereq:["DE16-0208"]},
    {code:"DE16-0429", name:"Sistema de Justicia y Mecanismos de Soluci√≥n de Conflictos", prereq:["DE16-0213"]},
    {code:"DE16-0430", name:"Teolog√≠a I", prereq:["DE16-0208"]}
  ]},
  {sem:"V", courses:[
    {code:"DE16-0531", name:"Acto Jur√≠dico", prereq:["DE16-0425"]},
    {code:"DE16-0532", name:"Derecho Administrativo I", prereq:["DE16-0424"]},
    {code:"DE16-0533", name:"Derecho Constitucional II", prereq:["DE16-0429","DE16-0424"]},
    {code:"DE16-0534", name:"Derecho Penal Especial", prereq:["DE16-0426"]},
    {code:"DE16-0535", name:"Derecho Procesal General", prereq:["DE16-0429"]},
    {code:"DE16-0536", name:"Metodolog√≠a de la Investigaci√≥n Jur√≠dica", prereq:["DE16-0320","DE16-0426","DE16-0425","DE16-0424"]},
    {code:"DE16-0537", name:"Moral", prereq:["DE16-0430","DE16-0320"]}
  ]},
  {sem:"VI", courses:[
    {code:"DE16-0638", name:"Argumentaci√≥n Jur√≠dica", prereq:["DE16-0536","DE16-0535","DE16-0533"]},
    {code:"DE16-0639", name:"Derecho Administrativo II", prereq:["DE16-0532"]},
    {code:"DE16-0640", name:"Derecho Internacional P√∫blico", prereq:["DE16-0533"]},
    {code:"DE16-0641", name:"Derecho Procesal Civil I", prereq:["DE16-0535"]},
    {code:"DE16-0642", name:"Derechos Reales", prereq:["DE16-0427","DE16-0531"]},
    {code:"DE16-0643", name:"Suficiencia de Mitad de Carrera", prereq:["DE16-0536"]},
    {code:"DE16-0644", name:"Teolog√≠a II", prereq:["DE16-0430"]},
    {code:"DE16-0645", name:"Seminario Penal (Penal Econ√≥mico y Delitos contra la AP)", prereq:["DE16-0534"]},
    {code:"DE16-0646", name:"Seminario Introducci√≥n al Derecho Comparado", prereq:["DE16-0536"]},
    {code:"DE16-0647", name:"Historia de la Filosof√≠a Pol√≠tica (EH)", prereq:["DE16-0537","DE16-0424"]}
  ]},
  {sem:"VII", courses:[
    {code:"DE16-0748", name:"Contabilidad y An√°lisis Financiero", prereq:["__128_CREDITS__"]},
    {code:"DE16-0749", name:"Derecho de Obligaciones", prereq:["DE16-0642"]},
    {code:"DE16-0750", name:"Derecho Procesal Civil II", prereq:["DE16-0642","DE16-0641","DE16-0638"]},
    {code:"DE16-0751", name:"Derecho Procesal Constitucional", prereq:["DE16-0638"]},
    {code:"DE16-0752", name:"Derecho Tributario I", prereq:["DE16-0639"]},
    {code:"DE16-0753", name:"Historia del Per√∫ I", prereq:["DE16-0319"]},
    {code:"DE16-0754", name:"Derecho Municipal y Regional (EE4)", prereq:["DE16-0639"]},
    {code:"DE16-0755", name:"Derecho de la Propiedad Intelectual (EE3)", prereq:["DE16-0642","DE16-0639"]},
    {code:"DE16-0756", name:"Seminario Organizaciones Internacionales (EE2)", prereq:["DE16-0640"]}
  ]},
  {sem:"VIII", courses:[
    {code:"DE16-0857", name:"Derecho de Contratos I: Teor√≠a General", prereq:["DE16-0749"]},
    {code:"DE16-0858", name:"Derecho Laboral I", prereq:["DE16-0640","DE16-0749"]},
    {code:"DE16-0859", name:"Derecho Mercantil I", prereq:["DE16-0749"]},
    {code:"DE16-0860", name:"Derecho Procesal Penal", prereq:["DE16-0638","DE16-0534"]},
    {code:"DE16-0861", name:"Derecho Tributario II: Impuesto a la Renta", prereq:["DE16-0752","DE16-0748"]},
    {code:"DE16-0862", name:"Historia del Per√∫ II", prereq:["DE16-0753"]},
    {code:"DE16-0863", name:"Derecho y Biotecnolog√≠a (EE2)", prereq:["DE16-0640","DE16-0860"]},
    {code:"DE16-0864", name:"Seminario Criminal√≠stica, Ciencias Forenses y Criminolog√≠a (EE1)", prereq:[]},
    {code:"DE16-0865", name:"Derecho de la Integraci√≥n (EE2)", prereq:["DE16-0640"]}
  ]},
  {sem:"IX", courses:[
    {code:"DE16-0966", name:"Derecho de Contratos II: Contratos T√≠picos", prereq:["DE16-0857"]},
    {code:"DE16-0967", name:"Derecho Laboral II", prereq:["DE16-0858"]},
    {code:"DE16-0968", name:"Derecho Mercantil II: Sociedades", prereq:["DE16-0859","DE16-0748"]},
    {code:"DE16-0969", name:"Derecho Tributario III: Imposici√≥n al Consumo y Tributaci√≥n Municipal", prereq:["DE16-0861"]},
    {code:"DE16-0970", name:"Ense√±anza Social de la Iglesia", prereq:["DE16-0862","DE16-0537"]},
    {code:"DE16-0971", name:"Taller de Negociaci√≥n, Mediaci√≥n y Conciliaci√≥n", prereq:["DE16-0857","DE16-0428"]},
    {code:"DE16-0972", name:"Derecho Procesal Laboral (EE1)", prereq:["DE16-0858","DE16-0638"]},
    {code:"DE16-0973", name:"Seminario Derecho y Nuevas Tecnolog√≠as (EE3)", prereq:["DE16-0859","DE16-0857"]},
    {code:"DE16-0974", name:"Taller de Litigaci√≥n Oral (EE1)", prereq:["DE16-0860","DE16-0858","DE16-0638"]}
  ]},
  {sem:"X", courses:[
    {code:"DE16-1075", name:"Arbitraje", prereq:["DE16-0535","DE16-0971","DE16-0968"]},
    {code:"DE16-1076", name:"Derecho de Familia", prereq:["DE16-0749","DE16-0970"]},
    {code:"DE16-1077", name:"√âtica Profesional", prereq:["DE16-0537"]},
    {code:"DE16-1078", name:"Filosof√≠a del Derecho", prereq:["DE16-0751","DE16-0537"]},
    {code:"DE16-1079", name:"Responsabilidad Civil y Seguros", prereq:["DE16-0857"]},
    {code:"DE16-1080", name:"Seminario de Investigaci√≥n Jur√≠dica I", prereq:["DE16-0643","__190_CREDITS__"]},
    {code:"DE16-1081", name:"Seminario Derecho del Consumidor y Protecci√≥n del Cr√©dito (EE1 - EE3)", prereq:["DE16-0639","DE16-0968"]},
    {code:"DE16-1082", name:"Derecho Aduanero y Comercio Internacional (EE2 - EE3)", prereq:["DE16-0857","DE16-0969"]},
    {code:"DE16-1083", name:"Seminario de Contrataci√≥n Estatal y APP (EE4)", prereq:["DE16-0857","DE16-0539"]}
  ]},
  {sem:"XI", courses:[
    {code:"DE16-1184", name:"Contratos Modernos", prereq:["DE16-1079","DE16-0968"]},
    {code:"DE16-1185", name:"Derecho de Sucesiones", prereq:["DE16-1076"]},
    {code:"DE16-1186", name:"Derechos Humanos", prereq:["DE16-1078","DE16-0970"]},
    {code:"DE16-1187", name:"Elementos de Derecho Can√≥nico y Eclesi√°stico del Estado", prereq:["DE16-1078","DE16-1076"]},
    {code:"DE16-1188", name:"Financiamiento y garant√≠as", prereq:["DE16-0748","DE16-0639","DE16-1079","DE16-0968"]},
    {code:"DE16-1189", name:"Seminario de Investigaci√≥n Jur√≠dica II", prereq:["DE16-1180","DE16-1080"]},
    {code:"DE16-1190", name:"Derecho Bancario (EE3)", prereq:["DE16-1079","DE16-0968"]},
    {code:"DE16-1191", name:"Derecho Minero (EE4)", prereq:["DE16-0968","DE16-0639"]},
    {code:"DE16-1192", name:"Derecho de la Competencia y Regulaci√≥n (EE4)", prereq:["DE16-0639","DE16-0427","DE16-0968"]}
  ]},
  {sem:"XII", courses:[
    {code:"DE16-1293", name:"Derecho Internacional Privado", prereq:["DE16-1185"]},
    {code:"DE16-1294", name:"Derecho Notarial y Registral", prereq:["DE16-0966","DE16-0968","DE16-1185"]},
    {code:"DE16-1295", name:"Ingl√©s T√©cnico Jur√≠dico", prereq:[]},
    {code:"DE16-1296", name:"Pr√°ctica Empresarial: Mercantil/Trib/Lab/Gesti√≥n", prereq:["DE16-1188","DE16-1184","DE16-1077","DE16-0969","DE16-0967"]},
    {code:"DE16-1297", name:"Pr√°ctica Forense Civil y Penal", prereq:["DE16-0860","DE16-0968","DE16-1188","DE16-1077"]},
    {code:"DE16-1298", name:"Pr√°ctica Forense en Derecho Constitucional y Administrativo", prereq:["DE16-0639","DE16-1187","DE16-1186","DE16-1077"]},
    {code:"DE16-12101", name:"Arbitraje Comercial Int. y de Inversiones (EE1 - EE2)", prereq:["DE16-1188","DE16-1075"]},
    {code:"DE16-1299", name:"Derecho de la Energ√≠a (EE4)", prereq:["DE16-1192"]},
    {code:"DE16-12100", name:"Direcci√≥n y Liderazgo Estrat√©gico (EE3 - EE4)", prereq:["DE16-0748","DE16-1077","DE16-0106"]}
  ]}
];

/* STORAGE KEY */
const STORAGE_KEY = "malla_derecho_plan2016_pastel_conejos_v2";

/* load / save */
function loadSaved(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) return {};
    return JSON.parse(raw);
  }catch(e){
    console.warn("Error leyendo progreso:", e);
    return {};
  }
}
function saveSaved(obj){
  try{
    localStorage.setItem(STORAGE_KEY, JSON.stringify(obj));
  }catch(e){
    console.warn("Error guardando progreso:", e);
  }
}

/* isUnlocked: require all prereq codes to be in saved
   ignore tokens starting with "__" (credit requirements)
*/
function isUnlocked(code, saved){
  for(const sem of MALLA){
    const course = sem.courses.find(c => c.code === code);
    if(course){
      const prereq = course.prereq || [];
      for(const p of prereq){
        if(typeof p !== "string") continue;
        if(p.startsWith("__")) continue; // special token: treat as unlocked by default
        if(!saved[p]) return false;
      }
      return true;
    }
  }
  return true;
}

/* render function */
function render(){
  const container = document.getElementById("malla");
  container.innerHTML = "";
  const saved = loadSaved();

  for(const sem of MALLA){
    const section = document.createElement("section");
    section.className = "semester";

    const h = document.createElement("h3");
    h.innerHTML = `Semestre ${sem.sem} <span>(${sem.courses.length} materias)</span>`;
    section.appendChild(h);

    const list = document.createElement("div");
    list.className = "course-list";

    for(const course of sem.courses){
      const unlocked = isUnlocked(course.code, saved);
      const approved = !!saved[course.code];

      const item = document.createElement("div");
      item.className = "course" + (unlocked ? "" : " locked");
      item.setAttribute("data-code", course.code);
      item.setAttribute("role","button");
      item.setAttribute("tabindex", unlocked ? 0 : -1);

      // left block
      const left = document.createElement("div");
      left.className = "left";
      const codeEl = document.createElement("div");
      codeEl.className = "code";
      codeEl.textContent = course.code.replace("DE16-","D-");
      const meta = document.createElement("div");
      meta.className = "meta";
      const title = document.createElement("div");
      title.className = "title";
      title.textContent = course.name;
      const sub = document.createElement("div");
      sub.className = "sub";
      sub.textContent = (course.prereq && course.prereq.length) ? "Prereq: " + course.prereq.join(", ") : "Sin prerrequisitos";
      meta.appendChild(title);
      meta.appendChild(sub);
      left.appendChild(codeEl);
      left.appendChild(meta);

      // right block
      const right = document.createElement("div");
      right.className = "status";
      const badge = document.createElement("div");
      badge.className = "badge " + (approved ? "approved" : (unlocked ? "available" : "locked"));
      badge.textContent = approved ? "Aprobada" : (unlocked ? "Disponible" : "Bloqueada");
      right.appendChild(badge);

      item.appendChild(left);
      item.appendChild(right);

      // tooltip for locked
      if(!unlocked){
        const missing = course.prereq.filter(p => !p.startsWith("__") && !saved[p]);
        const tooltip = document.createElement("div");
        tooltip.className = "tooltip";
        tooltip.innerHTML = `<strong>Faltan:</strong> ${missing.join(", ")}`;
        item.appendChild(tooltip);
      }

      // click
      item.addEventListener("click", () => {
        const s = loadSaved();
        if(!isUnlocked(course.code, s)){
          // visual feedback
          item.animate([{transform:"translateY(0)"},{transform:"translateY(-6px)"},{transform:"translateY(0)"}],{duration:180});
          return;
        }
        if(s[course.code]) delete s[course.code];
        else s[course.code] = {when: Date.now()};
        saveSaved(s);
        render();
      });

      // keyboard
      item.addEventListener("keydown", (e) => {
        if(e.key === "Enter" && isUnlocked(course.code, loadSaved())){
          item.click();
        }
      });

      list.appendChild(item);
    }

    section.appendChild(list);
    container.appendChild(section);
  }
}

/* buttons: reset / export / import */
document.getElementById("reset").addEventListener("click", () => {
  if(!confirm("Borrar√°s TODO el progreso guardado. ¬øContinuar?")) return;
  localStorage.removeItem(STORAGE_KEY);
  render();
});

document.getElementById("export").addEventListener("click", () => {
  const s = loadSaved();
  const dataStr = JSON.stringify(s, null, 2);
  const blob = new Blob([dataStr], {type:"application/json"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "progreso_malla_derecho_plan2016.json";
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
});

document.getElementById("import").addEventListener("click", () => {
  const input = document.createElement("input");
  input.type = "file";
  input.accept = "application/json";
  input.onchange = () => {
    if(!input.files || input.files.length === 0) return;
    const f = input.files[0];
    const reader = new FileReader();
    reader.onload = (ev) => {
      try{
        const data = JSON.parse(ev.target.result);
        if(typeof data !== "object") throw new Error("Formato inv√°lido");
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        render();
        alert("Progreso importado correctamente.");
      } catch(e){
        alert("Archivo inv√°lido: " + e.message);
      }
    };
    reader.readAsText(f);
  };
  input.click();
});

/* initialize and focus */
render();
window.addEventListener("load", () => {
  const saved = loadSaved();
  for(const sem of MALLA){
    for(const c of sem.courses){
      if(isUnlocked(c.code, saved)){
        const el = document.querySelector(`[data-code="${c.code}"]`);
        if(el){ el.focus(); return; }
      }
    }
  }
});
</script>
</body>
</html>
