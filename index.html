<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Plan de estudios ‚ãÜ‚≠íÀö ìçùÔΩ°‚ãÜ (2016)</title>

<style>
/* ==========================
   PALETA PASTEL + EST√âTICA
   ========================== */
:root {
  --bg-1: #fff7ff;
  --bg-2: #f2f7ff;
  --panel: #ffffff;
  --pastel-pink: #f7c9d4;
  --pastel-blue: #c8d9ff;
  --pastel-lilac: #d8c7ff;
  --pastel-mint:  #c8f2e0;

  --primary: #a38ad6;
  --accent: #8bbde9;
  --ok: #7acfa5;
  --danger: #e88b9c;

  --shadow: 0 6px 18px rgba(140, 120, 180, 0.12);
  --radius: 18px;

  font-family: "Poppins", "Inter", "Segoe UI", Arial, sans-serif;
}
*{box-sizing:border-box}
body {
  margin: 0;
  padding: 32px;
  background: linear-gradient(180deg, var(--bg-1), var(--bg-2));
  color: #333;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
}

/* HEADER */
header {
  display: flex;
  justify-content: space-between;
  flex-wrap: wrap;
  gap: 20px;
  margin-bottom: 28px;
}
h1 {
  margin: 0;
  font-size: 26px;
  font-weight: 700;
  color: #7d67b4;
}
p.lead {
  margin: 6px 0 0 0;
  font-size: 14px;
  color: #6b6b6b;
}

/* BUTTONS */
.controls { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
button {
  border: none;
  border-radius: 12px;
  padding: 10px 14px;
  cursor: pointer;
  font-size: 13px;
  transition: opacity .16s, transform .12s;
  box-shadow: 0 6px 18px rgba(120,80,160,0.06);
}
button:hover { opacity:0.92; transform: translateY(-2px); }
#export { background: var(--pastel-blue); color: #394b7c; }
#import { background: var(--pastel-lilac); color: #4d3b77; }
#reset { background: var(--pastel-pink); color: #7e2e3f; }

/* GRID */
.grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 18px;
}
@media(max-width:1100px){ .grid { grid-template-columns: repeat(3,1fr); } }
@media(max-width:800px){ .grid { grid-template-columns: repeat(2,1fr); } }
@media(max-width:580px){ .grid { grid-template-columns: 1fr; } }

/* SEMESTER CARD */
.semester {
  background: var(--panel);
  border-radius: var(--radius);
  padding: 18px;
  box-shadow: var(--shadow);
  border: 1px solid rgba(180,150,230,0.08);
  min-height: 140px;
}
.semester h3 {
  margin: 0 0 12px 0;
  font-size: 18px;
  color: #7d67b4;
  display: flex;
  justify-content: space-between;
  align-items:center;
}
.semester h3 span { color:#999; font-size:13px; }

/* COURSE ITEM */
.course-list {
  display:flex;
  flex-direction:column;
  gap:10px;
}
.course {
  border-radius: 14px;
  padding: 12px;
  background: linear-gradient(180deg, rgba(255,255,255,0.95), rgba(247,242,255,0.85));
  border: 1px solid rgba(230,220,255,0.7);
  display:flex;
  justify-content:space-between;
  align-items:center;
  box-shadow: 0 6px 14px rgba(110,80,170,0.05);
  cursor: pointer;
  position:relative;
  transition: transform .12s ease, box-shadow .12s ease, opacity .12s ease;
}
.course:hover { transform: translateY(-4px); box-shadow: 0 10px 30px rgba(100,60,150,0.12); }
.course.locked { opacity:0.65; cursor: default; transform: none; box-shadow:none; }

/* LEFT SIDE */
.left { display:flex; gap:10px; align-items:center; }
.code {
  background: linear-gradient(180deg,var(--pastel-mint), #e6fff4);
  color: #2a5946;
  padding:8px; border-radius:10px;
  font-size:12px; min-width:70px; text-align:center; font-weight:700;
}
.meta .title { font-size:14px; font-weight:600; color:#3d2f63; }
.meta .sub { font-size:12px; color:#777; margin-top:2px; }

/* STATUS */
.status .badge {
  padding:8px 10px; border-radius:10px; font-size:12px; font-weight:700; color:#fff;
  min-width:86px; text-align:center;
}
.badge.approved { background:var(--ok); color:#0e3f2d; font-weight:700; }
.badge.locked { background:var(--danger); color:#501a23; }
.badge.available { background: linear-gradient(180deg,var(--pastel-blue), #eaf3ff); color:#27406b; font-weight:700; }

/* TOOLTIP */
.tooltip {
  display:none;
  position:absolute;
  top: calc(100% + 8px);
  left: 14px;
  background: #4f3d78;
  color:#fff; padding:8px 10px; border-radius:10px; font-size:12px;
  white-space:nowrap; box-shadow: 0 8px 22px rgba(60,40,100,0.25); z-index:40;
}
.course.locked:hover .tooltip { display:block; transform:translateY(0); }

/* FOOTER */
footer {
  margin-top:28px; font-size:13px; color:#777; display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:10px;
}
.legend { display:flex; gap:10px; align-items:center; }
.legend .item { background:#fff; border-radius:10px; padding:6px 10px; display:flex; gap:8px; align-items:center; border:1px solid rgba(230,220,255,0.6); }

/* small screens: header layout */
@media(max-width:720px){
  header{flex-direction:column; align-items:flex-start;}
}
</style>
</head>
<body>
<header>
  <div>
    <h1>Malla curricular ‚Äî Derecho (Pastel Edition ‚Äî Completa)</h1>
    <p class="lead">Haz clic en una materia para marcarla como aprobada. Las materias con prerrequisitos aparecen bloqueadas hasta aprobarlos. Progreso guardado en tu navegador.</p>
  </div>
  <div class="controls">
    <button id="export">Exportar progreso (JSON)</button>
    <button id="import">Importar progreso</button>
    <button id="reset">Borrar progreso</button>
  </div>
</header>

<main>
  <div id="malla" class="grid" aria-live="polite"></div>
</main>

<footer>
  <div class="legend">
    <div class="item"><div style="width:14px;height:14px;background:var(--ok);border-radius:4px"></div>Aprobada</div>
    <div class="item"><div style="width:14px;height:14px;background:var(--danger);border-radius:4px"></div>Bloqueada</div>
    <div class="item"><div style="width:14px;height:14px;background:var(--pastel-blue);border-radius:4px"></div>Disponible</div>
  </div>
  <div>Fuente: Plan de estudios Derecho 2016 (revisi√≥n 2019)</div>
</footer>

<script>
/* ==========================
   MALLA COMPLETA (12 semestres)
   Datos extra√≠dos del plan de estudios proporcionado por el usuario.
   Cada objeto: {code, name, prereq:[codes...]}
   Nota: Tokens especiales como __128_CREDITS__ se tratan como requisitos no verificados autom√°ticamente.
   ========================== */

const MALLA = [
  {sem:"I", courses:[
    {code:"DE16-0101", name:"Comunicaci√≥n I", prereq:[]},
    {code:"DE16-0102", name:"Introducci√≥n a la Filosof√≠a", prereq:[]},
    {code:"DE16-0103", name:"Introducci√≥n a la Vida Universitaria", prereq:[]},
    {code:"DE16-0104", name:"Introducci√≥n al Estudio del Derecho", prereq:[]},
    {code:"DE16-0105", name:"Metodolog√≠a del Estudio", prereq:[]},
    {code:"DE16-0106", name:"Taller de Liderazgo", prereq:[]},
    {code:"DE16-0107", name:"Teatro", prereq:[]}
  ]},
  {sem:"II", courses:[
    {code:"DE16-0208", name:"Antropolog√≠a Filos√≥fica y Teol√≥gica", prereq:["DE16-0102"]},
    {code:"DE16-0209", name:"Comunicaci√≥n II", prereq:["DE16-0101"]},
    {code:"DE16-0210", name:"Historia de la Cultura Occidental I", prereq:["DE16-0102"]},
    {code:"DE16-0211", name:"Historia General del Derecho", prereq:["DE16-0105","DE16-0104"]},
    {code:"DE16-0212", name:"Ret√≥rica y Dial√©ctica", prereq:["DE16-0104","DE16-0107","DE16-0101"]},
    {code:"DE16-0213", name:"Teor√≠a del Derecho", prereq:["DE16-0105","DE16-0106","DE16-0104"]},
    {code:"DE16-0214", name:"Apreciaci√≥n Art√≠stica (EH)", prereq:[]},
    {code:"DE16-0215", name:"Apreciaci√≥n Literaria (EH)", prereq:[]}
  ]},
  {sem:"III", courses:[
    {code:"DE16-0316", name:"Bases Romanistas del Derecho Contempor√°neo", prereq:["DE16-0211"]},
    {code:"DE16-0317", name:"Ciencia Pol√≠tica", prereq:["DE16-0102","DE16-0213"]},
    {code:"DE16-0318", name:"Derecho Natural", prereq:["DE16-0208","DE16-0209","DE16-0213","DE16-0212"]},
    {code:"DE16-0319", name:"Historia de la Cultura Occidental II", prereq:["DE16-0210"]},
    {code:"DE16-0320", name:"L√≥gica y Gnoseolog√≠a", prereq:["DE16-0208"]},
    {code:"DE16-0321", name:"Matem√°tica para abogados", prereq:["DE16-0213"]},
    {code:"DE16-0322", name:"Apreciaci√≥n Musical (EH)", prereq:[]},
    {code:"DE16-0323", name:"Sociolog√≠a y Derecho (EH)", prereq:["DE16-0213"]}
  ]},
  {sem:"IV", courses:[
    {code:"DE16-0424", name:"Derecho Constitucional I", prereq:["DE16-0318","DE16-0317"]},
    {code:"DE16-0425", name:"Derecho de Personas", prereq:["DE16-0318","DE16-0316"]},
    {code:"DE16-0426", name:"Derecho Penal General", prereq:["DE16-0318"]},
    {code:"DE16-0427", name:"Derecho y Econom√≠a", prereq:["DE16-0321"]},
    {code:"DE16-0428", name:"Psicolog√≠a", prereq:["DE16-0208"]},
    {code:"DE16-0429", name:"Sistema de Justicia y Mecanismos de Soluci√≥n de Conflictos", prereq:["DE16-0213"]},
    {code:"DE16-0430", name:"Teolog√≠a I", prereq:["DE16-0208"]}
  ]},
  {sem:"V", courses:[
    {code:"DE16-0531", name:"Acto Jur√≠dico", prereq:["DE16-0425"]},
    {code:"DE16-0532", name:"Derecho Administrativo I", prereq:["DE16-0424"]},
    {code:"DE16-0533", name:"Derecho Constitucional II", prereq:["DE16-0429","DE16-0424"]},
    {code:"DE16-0534", name:"Derecho Penal Especial", prereq:["DE16-0426"]},
    {code:"DE16-0535", name:"Derecho Procesal General", prereq:["DE16-0429"]},
    {code:"DE16-0536", name:"Metodolog√≠a de la Investigaci√≥n Jur√≠dica", prereq:["DE16-0320","DE16-0426","DE16-0425","DE16-0424"]},
    {code:"DE16-0537", name:"Moral", prereq:["DE16-0430","DE16-0320"]}
  ]},
  {sem:"VI", courses:[
    {code:"DE16-0638", name:"Argumentaci√≥n Jur√≠dica", prereq:["DE16-0536","DE16-0535","DE16-0533"]},
    {code:"DE16-0639", name:"Derecho Administrativo II", prereq:["DE16-0532"]},
    {code:"DE16-0640", name:"Derecho Internacional P√∫blico", prereq:["DE16-0533"]},
    {code:"DE16-0641", name:"Derecho Procesal Civil I", prereq:["DE16-0535"]},
    {code:"DE16-0642", name:"Derechos Reales", prereq:["DE16-0427","DE16-0531"]},
    {code:"DE16-0643", name:"Suficiencia de Mitad de Carrera", prereq:["DE16-0536"]},
    {code:"DE16-0644", name:"Teolog√≠a II", prereq:["DE16-0430"]},
    {code:"DE16-0645", name:"Seminario Penal (Penal Econ√≥mico y Delitos contra la AP)", prereq:["DE16-0534"]},
    {code:"DE16-0646", name:"Seminario Introducci√≥n al Derecho Comparado", prereq:["DE16-0536"]},
    {code:"DE16-0647", name:"Historia de la Filosof√≠a Pol√≠tica (EH)", prereq:["DE16-0537","DE16-0424"]}
  ]},
  {sem:"VII", courses:[
    {code:"DE16-0748", name:"Contabilidad y An√°lisis Financiero", prereq:["__128_CREDITS__"]},
    {code:"DE16-0749", name:"Derecho de Obligaciones", prereq:["DE16-0642"]},
    {code:"DE16-0750", name:"Derecho Procesal Civil II", prereq:["DE16-0642","DE16-0641","DE16-0638"]},
    {code:"DE16-0751", name:"Derecho Procesal Constitucional", prereq:["DE16-0638"]},
    {code:"DE16-0752", name:"Derecho Tributario I", prereq:["DE16-0639"]},
    {code:"DE16-0753", name:"Historia del Per√∫ I", prereq:["DE16-0319"]},
    {code:"DE16-0754", name:"Derecho Municipal y Regional (EE4)", prereq:["DE16-0639"]},
    {code:"DE16-0755", name:"Derecho de la Propiedad Intelectual (EE3)", prereq:["DE16-0642","DE16-0639"]},
    {code:"DE16-0756", name:"Seminario Organizaciones Internacionales (EE2)", prereq:["DE16-0640"]}
  ]},
  {sem:"VIII", courses:[
    {code:"DE16-0857", name:"Derecho de Contratos I: Teor√≠a General", prereq:["DE16-0749"]},
    {code:"DE16-0858", name:"Derecho Laboral I", prereq:["DE16-0640","DE16-0749"]},
    {code:"DE16-0859", name:"Derecho Mercantil I", prereq:["DE16-0749"]},
    {code:"DE16-0860", name:"Derecho Procesal Penal", prereq:["DE16-0638","DE16-0534"]},
    {code:"DE16-0861", name:"Derecho Tributario II: Impuesto a la Renta", prereq:["DE16-0752","DE16-0748"]},
    {code:"DE16-0862", name:"Historia del Per√∫ II", prereq:["DE16-0753"]},
    {code:"DE16-0863", name:"Derecho y Biotecnolog√≠a (EE2)", prereq:["DE16-0640","DE16-0860"]},
    {code:"DE16-0864", name:"Seminario Criminal√≠stica, Ciencias Forenses y Criminolog√≠a (EE1)", prereq:[]},
    {code:"DE16-0865", name:"Derecho de la Integraci√≥n (EE2)", prereq:["DE16-0640"]}
  ]},
  {sem:"IX", courses:[
    {code:"DE16-0966", name:"Derecho de Contratos II: Contratos T√≠picos", prereq:["DE16-0857"]},
    {code:"DE16-0967", name:"Derecho Laboral II", prereq:["DE16-0858"]},
    {code:"DE16-0968", name:"Derecho Mercantil II: Sociedades", prereq:["DE16-0859","DE16-0748"]},
    {code:"DE16-0969", name:"Derecho Tributario III: Imposici√≥n al Consumo y Tributaci√≥n Municipal", prereq:["DE16-0861"]},
    {code:"DE16-0970", name:"Ense√±anza Social de la Iglesia", prereq:["DE16-0862","DE16-0537"]},
    {code:"DE16-0971", name:"Taller de Negociaci√≥n, Mediaci√≥n y Conciliaci√≥n", prereq:["DE16-0857","DE16-0428"]},
    {code:"DE16-0972", name:"Derecho Procesal Laboral (EE1)", prereq:["DE16-0858","DE16-0638"]},
    {code:"DE16-0973", name:"Seminario Derecho y Nuevas Tecnolog√≠as (EE3)", prereq:["DE16-0859","DE16-0857"]},
    {code:"DE16-0974", name:"Taller de Litigaci√≥n Oral (EE1)", prereq:["DE16-0860","DE16-0858","DE16-0638"]}
  ]},
  {sem:"X", courses:[
    {code:"DE16-1075", name:"Arbitraje", prereq:["DE16-0535","DE16-0971","DE16-0968"]},
    {code:"DE16-1076", name:"Derecho de Familia", prereq:["DE16-0749","DE16-0970"]},
    {code:"DE16-1077", name:"√âtica Profesional", prereq:["DE16-0537"]},
    {code:"DE16-1078", name:"Filosof√≠a del Derecho", prereq:["DE16-0751","DE16-0537"]},
    {code:"DE16-1079", name:"Responsabilidad Civil y Seguros", prereq:["DE16-0857"]},
    {code:"DE16-1080", name:"Seminario de Investigaci√≥n Jur√≠dica I", prereq:["DE16-0643","__190_CREDITS__"]},
    {code:"DE16-1081", name:"Seminario Derecho del Consumidor y Protecci√≥n del Cr√©dito (EE1 - EE3)", prereq:["DE16-0639","DE16-0968"]},
    {code:"DE16-1082", name:"Derecho Aduanero y Comercio Internacional (EE2 - EE3)", prereq:["DE16-0857","DE16-0969"]},
    {code:"DE16-1083", name:"Seminario de Contrataci√≥n Estatal y APP (EE4)", prereq:["DE16-0857","DE16-0539"]}
  ]},
  {sem:"XI", courses:[
    {code:"DE16-1184", name:"Contratos Modernos", prereq:["DE16-1079","DE16-0968"]},
    {code:"DE16-1185", name:"Derecho de Sucesiones", prereq:["DE16-1076"]},
    {code:"DE16-1186", name:"Derechos Humanos", prereq:["DE16-1078","DE16-0970"]},
    {code:"DE16-1187", name:"Elementos de Derecho Can√≥nico y Eclesi√°stico del Estado", prereq:["DE16-1078","DE16-1076"]},
    {code:"DE16-1188", name:"Financiamiento y garant√≠as", prereq:["DE16-0748","DE16-0639","DE16-1079","DE16-0968"]},
    {code:"DE16-1189", name:"Seminario de Investigaci√≥n Jur√≠dica II", prereq:["DE16-1180","DE16-1080"]},
    {code:"DE16-1190", name:"Derecho Bancario (EE3)", prereq:["DE16-1079","DE16-0968"]},
    {code:"DE16-1191", name:"Derecho Minero (EE4)", prereq:["DE16-0968","DE16-0639"]},
    {code:"DE16-1192", name:"Derecho de la Competencia y Regulaci√≥n (EE4)", prereq:["DE16-0639","DE16-0427","DE16-0968"]}
  ]},
  {sem:"XII", courses:[
    {code:"DE16-1293", name:"Derecho Internacional Privado", prereq:["DE16-1185"]},
    {code:"DE16-1294", name:"Derecho Notarial y Registral", prereq:["DE16-0966","DE16-0968","DE16-1185"]},
    {code:"DE16-1295", name:"Ingl√©s T√©cnico Jur√≠dico", prereq:[]},
    {code:"DE16-1296", name:"Pr√°ctica Empresarial: Mercantil/Trib/Lab/Gesti√≥n", prereq:["DE16-1188","DE16-1184","DE16-1077","DE16-0969","DE16-0967"]},
    {code:"DE16-1297", name:"Pr√°ctica Forense Civil y Penal", prereq:["DE16-0860","DE16-0968","DE16-1188","DE16-1077"]},
    {code:"DE16-1298", name:"Pr√°ctica Forense en Derecho Constitucional y Administrativo", prereq:["DE16-0639","DE16-1187","DE16-1186","DE16-1077"]},
    {code:"DE16-12101", name:"Arbitraje Comercial Int. y de Inversiones (EE1 - EE2)", prereq:["DE16-1188","DE16-1075"]},
    {code:"DE16-1299", name:"Derecho de la Energ√≠a (EE4)", prereq:["DE16-1192"]},
    {code:"DE16-12100", name:"Direcci√≥n y Liderazgo Estrat√©gico (EE3 - EE4)", prereq:["DE16-0748","DE16-1077","DE16-0106"]}
  ]}
];

/* ==========================
   STORAGE KEY
   ========================== */
const STORAGE_KEY = "malla_derecho_plan2016_pastel_v1";

/* ==========================
   HELPERS: load / save
   ========================== */
function loadSaved(){
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) return {};
    return JSON.parse(raw);
  } catch(e){
    console.warn("No se pudo leer progreso:", e);
    return {};
  }
}
function saveSaved(obj){
  try {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(obj));
  } catch(e){
    console.warn("No se pudo guardar progreso:", e);
  }
}

/* ==========================
   isUnlocked: all prereqs approved
   - ignores special tokens that start with __
   ========================== */
function isUnlocked(code, saved){
  // find course
  for(const sem of MALLA){
    const course = sem.courses.find(c => c.code === code);
    if(course){
      const prereq = course.prereq || [];
      for(const p of prereq){
        if(typeof p !== "string") continue;
        if(p.startsWith("__")) {
          // special token (credits): treat as unlocked by default
          continue;
        }
        if(!saved[p]) return false;
      }
      return true;
    }
  }
  return true;
}

/* ==========================
   RENDER
   ========================== */
function render(){
  const container = document.getElementById("malla");
  container.innerHTML = "";
  const saved = loadSaved();

  for(const sem of MALLA){
    const section = document.createElement("section");
    section.className = "semester";

    const h = document.createElement("h3");
    h.innerHTML = `Semestre ${sem.sem} <span>(${sem.courses.length} materias)</span>`;
    section.appendChild(h);

    const list = document.createElement("div");
    list.className = "course-list";

    for(const course of sem.courses){
      const unlocked = isUnlocked(course.code, saved);
      const approved = !!saved[course.code];

      const item = document.createElement("div");
      item.className = "course" + (unlocked ? "" : " locked");
      item.setAttribute("data-code", course.code);
      item.setAttribute("role", "button");
      item.setAttribute("tabindex", unlocked ? 0 : -1);

      // left
      const left = document.createElement("div");
      left.className = "left";
      const codeEl = document.createElement("div");
      codeEl.className = "code";
      codeEl.textContent = course.code.replace("DE16-","D-");
      const meta = document.createElement("div");
      meta.className = "meta";
      const title = document.createElement("div");
      title.className = "title";
      title.textContent = course.name;
      const sub = document.createElement("div");
      sub.className = "sub";
      sub.textContent = (course.prereq && course.prereq.length) ? "Prereq: " + course.prereq.join(", ") : "Sin prerrequisitos";
      meta.appendChild(title);
      meta.appendChild(sub);
      left.appendChild(codeEl);
      left.appendChild(meta);

      // right
      const right = document.createElement("div");
      right.className = "status";
      const badge = document.createElement("div");
      badge.className = "badge " + (approved ? "approved" : (unlocked ? "available" : "locked"));
      badge.textContent = approved ? "Aprobada" : (unlocked ? "Disponible" : "Bloqueada");
      right.appendChild(badge);

      item.appendChild(left);
      item.appendChild(right);

      // tooltip for locked showing missing prereqs
      if(!unlocked){
        const missing = course.prereq.filter(p => !p.startsWith("__") && !saved[p]);
        const tooltip = document.createElement("div");
        tooltip.className = "tooltip";
        tooltip.innerHTML = `<strong>Faltan:</strong> ${missing.join(", ")}`;
        item.appendChild(tooltip);
      }

      // click behaviour
      item.addEventListener("click", (ev) => {
        const s = loadSaved();
        if(!isUnlocked(course.code, s)) {
          // small feedback
          item.animate([{transform:"translateY(0)"},{transform:"translateY(-6px)"},{transform:"translateY(0)"}],{duration:180});
          return;
        }
        // toggle approved
        if(s[course.code]) {
          delete s[course.code];
        } else {
          s[course.code] = {when: Date.now()};
        }
        saveSaved(s);
        render();
      });

      // keyboard support
      item.addEventListener("keydown", (e) => {
        if(e.key === "Enter" && isUnlocked(course.code, loadSaved())){
          item.click();
        }
      });

      list.appendChild(item);
    }

    section.appendChild(list);
    container.appendChild(section);
  }
}

/* ==========================
   BUTTONS: reset / export / import
   ========================== */
document.getElementById("reset").addEventListener("click", () => {
  if(!confirm("Borrar√°s TODO el progreso guardado. ¬øContinuar?")) return;
  localStorage.removeItem(STORAGE_KEY);
  render();
});

document.getElementById("export").addEventListener("click", () => {
  const s = loadSaved();
  const dataStr = JSON.stringify(s, null, 2);
  const blob = new Blob([dataStr], {type:"application/json"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "progreso_malla_derecho_plan2016.json";
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
});

document.getElementById("import").addEventListener("click", () => {
  const input = document.createElement("input");
  input.type = "file";
  input.accept = "application/json";
  input.onchange = () => {
    if(!input.files || input.files.length === 0) return;
    const f = input.files[0];
    const reader = new FileReader();
    reader.onload = (ev) => {
      try{
        const data = JSON.parse(ev.target.result);
        if(typeof data !== "object") throw new Error("Formato inv√°lido");
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        render();
        alert("Progreso importado correctamente.");
      } catch(e){
        alert("Archivo inv√°lido: " + e.message);
      }
    };
    reader.readAsText(f);
  };
  input.click();
});

/* ==========================
   INIT
   ========================== */
render();

/* Accessibility: focus first available course */
window.addEventListener("load", () => {
  const saved = loadSaved();
  for(const sem of MALLA){
    for(const c of sem.courses){
      if(isUnlocked(c.code, saved)){
        const el = document.querySelector(`[data-code="${c.code}"]`);
        if(el){ el.focus(); return; }
      }
    }
  }
});
</script>
</body>
</html>
